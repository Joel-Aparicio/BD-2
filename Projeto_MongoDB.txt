// Criar a database
use projeto_BD2

// Associação Schema
db.createCollection("p_associacoes", {
   validator: {
      $jsonSchema: {
         required: ["nome", "pais"],
         properties: {
            nome: { type: "string" },
            url: { type: ['string', 'null'] },
            pais: { type: "string" },
            imagem: { type: ['string', 'null'] }
         }
      }
   }
});

// Estádio Schema
db.createCollection("p_estadios", {
   validator: {
      $jsonSchema: {
         required: ["nome", "pais", "cidade", "inauguracao", "ativo"],
         properties: {
            nome: { type: "string" },
	    imagem: { type: "string" },
	    pais: { type: "string" },
            cidade: { type: "string" },
	    inauguracao: { type: "number" },
	    ativo: { type: "boolean" },
	    lotacao: { type: "number" }
         }
      }
   }
});

// Posição Schema
db.createCollection("p_posicoes", {
   validator: {
      $jsonSchema: {
         required: ["nome"],
         properties: {
            nome: { type: "string" },
            descricao: { type: "string" }
         }
      }
   }
});

// Jogador Schema
db.createCollection("p_jogadores", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: [
            "nome",
            "num_camisola",
            "situacao"
         ],
         properties: {
            nome: {
               bsonType: "string"
            },
	    imagem: {
		bsonType: "string"
	    },
            idade: {
               bsonType: "number"
            },
            altura: {
               bsonType: "number"
            },
            peso: {
               bsonType: "number"
            },
            nacionalidade: {
               bsonType: "string"
            },
            num_camisola: {
               bsonType: "number"
            },
            valor_de_mercado: {
               bsonType: "number"
            },
            num_jogos: {
               bsonType: "number"
            },
            num_golos: {
               bsonType: "number"
            },
            situacao: {
               bsonType: "string"
            },
            posicao: {
               bsonType: "objectId"
            },
            equipa: {
               bsonType: "objectId",
               description: "ID da equipa à qual o jogador pertence, pode ser nulo."
            },
	    clube: {
        	bsonType: "objectId",
        	description: "ID do clube associado ao jogador. Necessário se 'equipa' estiver definido."
      	    },
            historico: {
               bsonType: "array",
               items: {
                  bsonType: "object",
                  properties: {
                     data_inicio: {
                        bsonType: "date"
                     },
                     data_fim: {
                        bsonType: "date"
                     },
                     situacao: {
                        bsonType: "string"
                     },
                     valor_contrato: {
                        bsonType: "number"
                     },
                     clube: {
                        bsonType: "object",
                        properties: {
                           clube_id: {
                              bsonType: "objectId"
                           },
                           nome: {
                              bsonType: "string"
                           }
                        }
                     }
                  }
               }
            }
         }
      }
   }
});

//Clube Schema
db.createCollection("p_clubes", {
   validator: {
      $jsonSchema: {
         required: ["nome", "pais", "extinto"],
         properties: {
            nome: { type: "string" },
	    imagem: { type: "string" },
            ano_fundacao: { type: "number" },
	    ano_extinto: { type: "number" },
            alcunhas: { type: "string" },
            pais: { type: "string" },
            cidade: { type: "string" },
            extinto: { type: "boolean" },
	    associacao: {
               bsonType: "objectId",
               description: "ID da Associação associado ao clube"
            },
            estadio: {
               bsonType: "objectId",
               description: "ID da Estadio associado ao clube"
            },
         }
      }
   }
});

//Equipas Schema
db.createCollection("p_equipas", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: ["clube_id", "nome", "ativa"],
         properties: {
            clube_id: {
               bsonType: "objectId"
            },
            nome: {
               bsonType: "string"
            },
            ativa: {
               bsonType: "bool"
            }
         }
      }
   }
});



// Formato Competição Schema
db.createCollection("p_formatos_competicao", {
   validator: {
      $jsonSchema: {
         required: ["nome", "descricao"],
         properties: {
            nome: { type: "string" },
	    descricao: { type: "string" },
	    valor_de_mercado: { type: "number" }
         }
      }
   }
});

// Competição Schema
db.createCollection("p_competicoes", {
   validator: {
      $jsonSchema: {
         required: ["nome", "data_inicio", "data_fim"],
         properties: {
            nome: { type: "string" },
            imagem: { type: "string" },
            data_inicio: { bsonType: "date" },
            data_fim: { bsonType: "date" },
	    finalizado: { type: "boolean" },
            formato: { bsonType: "objectId" },
            vencedor: { 
               bsonType: "objectId",
               description: "ID do clube Vencedor"
            }
         }
      }
   }
});


// Jogo Schema
db.createCollection("p_jogos", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["dia", "estado", "hora"],
      properties: {
        dia: {
          bsonType: "date"
        },
	hora: {
          bsonType: 'string',
          pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
      	},
        estado: {
          bsonType: "string"
        },
        duracao: {
          bsonType: "number"
        },
        prolongamento: {
          bsonType: "bool"
        },
        penaltis: {
          bsonType: "bool"
        },
        competicao: {
          bsonType: "objectId"
        },
        estadio: {
          bsonType: "objectId"
        },
        clube_casa: {
          bsonType: "objectId"
        },
        clube_fora: {
          bsonType: "objectId"
        },
        equipa_casa: {
          bsonType: "objectId"
        },
        equipa_fora: {
          bsonType: "objectId"
        },
	vencedor: {
          bsonType: 'objectId',
          description: 'ID do clube Vencedor.'
        }
      }
    }
  }
});

//GOLOS
db.createCollection("p_golos", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["jogo", "jogador", "minuto"],
      properties: {
        jogo: {
          bsonType: "objectId"
        },
        jogador: {
          bsonType: "objectId"
        },
	clube: { bsonType: "objectId" },
        penalti: {
          type: "boolean"
        },
        minuto: {
          type: "number"
        },
        compensacao: {
          type: "number"
        }
      }
    }
  }
});

//Faltas
db.createCollection("p_faltas", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["jogo", "jogador", "minuto"],
      properties: {
        jogo: {
          bsonType: "objectId"
        },
        jogador: {
          bsonType: "objectId"
        },
	clube: { bsonType: "objectId" },
        cartao: {
          type: "boolean"
        },
        cor_cartao: {
          type: "string"
        },
        minuto: {
          type: "number"
        },
        compensacao: {
          type: "number"
        }
      }
    }
  }
});

//Substituições
db.createCollection("p_substituicoes", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["jogo", "jogador_sai", "jogador_entra", "minuto"],
      properties: {
        jogo: {
          bsonType: "objectId"
        },
        jogador_sai: {
          bsonType: "objectId",
        },
        jogador_entra: {
          bsonType: "objectId",
        },
	clube: { bsonType: "objectId" },
        minuto: {
          type: "number"
        },
	compensacao: {
          bsonType: 'number'
      	},
        entrar: {
          type: "boolean"
        }
      }
    }
  }
});

//Penaltis
db.createCollection("p_penaltis", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["jogo", "jogador", "clube", "golo"],
      properties: {
        jogo: {
          bsonType: "objectId"
        },
        jogador: {
          bsonType: "objectId"
        },
        clube: {
          bsonType: "objectId"
        },
        golo: {
          type: "boolean"
        }
      }
    }
  }
});


db.createCollection("p_historico_clubeEquipa", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["clube", "jogador", "data_inicio", "situacao", "valor_contrato"],
      properties: {
        clube: {
          bsonType: "objectId",
          description: "ID do clube ao qual o jogador pertenceu"
        },
        jogador: {
          bsonType: "objectId",
          description: "ID do jogador relacionado"
        },
        data_inicio: { bsonType: "date" },
        data_fim: { bsonType: "date" },
        situacao: { 
	  type: "string",
          description: "Situação atual do vínculo (e.g., ativo, encerrado)"
        },
        valor_contrato: { type: "number" }
      }
    }
  }
});


//Clubes Favoritos Schema
db.createCollection("p_clubes_favoritos", {
   validator: {
      $jsonSchema: {
         required: ["utilizador_id"],
         properties: {
            utilizador_id: { type: "number" },
            clube_id: { bsonType: "objectId" },
         }
      }
   }
});
